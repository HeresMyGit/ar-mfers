<!DOCTYPE html>

<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-DEMRCQSGLC"></script>
<script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'G-DEMRCQSGLC');
        </script>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title></title>
<link href="demo-styles.css" rel="stylesheet"/>
<script defer="" src="https://github.com/lightlessdays/web-ar/blob/main/focus.js"></script>
<script src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js" type="module"></script>

<script>
    window.onload = function() {
        const urlParams = new URLSearchParams(window.location.search);
        const mferId = urlParams.get('id');
        if (mferId) {
            document.title = 'mfer #' + mferId;
            const headerElement = document.getElementById('dynamicHeader');
            if (headerElement) {
                headerElement.textContent = 'mfer #' + mferId;
            }
        }
    };
</script>
<style>
            model-viewer {
                width: 100%;
                max-width: 600px;  
                margin: 40px auto;  
                display: block;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            }

            #download-buttons {
                text-align: center;
                margin: 20px 0;
            }

            #download-buttons button {
                display: inline-block;
                margin: 0 10px;
            }

            @media (max-width: 768px) {
                #card {
                    padding-left: 80px;
                    padding-right: 80px;
                }
            }
        </style>
<link href="#" rel="icon" type="image/png"/></head>
<body>
<h1 id="dynamicHeader" style="text-align:center; margin: 20px 0;"></h1><h1 style="text-align:center; margin: 20px 0;"></h1>
<div id="card">
<div id="models-container"></div>
<div id="download-buttons">
<button id="png-btn">PNG</button>
<button id="vrm-btn">VRM</button>
<button id="fbx-btn">FBX</button>
<button id="usdz-btn">USDZ</button>
<button id="glb-btn">GLB</button>
</div>
</div>
<script type="module">
        const color_map = {
            "red": "ff7277",
            "green": "b7ff6c",
            "yellow": "5cd3ff",
            "orange": "feb66e",
            "blue": "5cd3ff",
            "tree": "ffe25f",
            "space": "898989",
            "graveyard": "7c7c7c"
        };

        async function fetchModelDetails() {
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');

            // Fetch metadata for the specific model
            const response = await fetch(`https://cybermfers.sfo3.digitaloceanspaces.com/cybermfers/public/metadata/${id}.json`);
            const metadata = await response.json();

            let bgColor = "FFFFFF";
            const backgroundTrait = metadata.attributes.find(attr => attr.trait_type === "background");
            if (backgroundTrait) {
                bgColor = color_map[backgroundTrait.value] || "FFFFFF";
            }

            // Fetch and display the model
            const container = document.getElementById("models-container");
            const modelViewer = document.createElement("model-viewer");
            modelViewer.style.backgroundColor = `#${bgColor}`;
            modelViewer.setAttribute("src", `https://cybermfers.sfo3.digitaloceanspaces.com/cybermfers/public/assets/glb/${id}.glb`);
            modelViewer.setAttribute("ios-src", `https://cybermfers.sfo3.digitaloceanspaces.com/cybermfers/public/assets/usdz/${id}.usdz`);
            modelViewer.setAttribute("alt", `mfer #${id}`);
            modelViewer.setAttribute("ar-status", "not-presenting");
            modelViewer.setAttribute("shadow-intensity", "1");
            modelViewer.setAttribute("camera-controls", "");
            modelViewer.setAttribute("auto-rotate", "");
            modelViewer.setAttribute("ar", "");
            modelViewer.setAttribute("autoplay", "");
            modelViewer.setAttribute("loop", "");

            container.appendChild(modelViewer);

            document.getElementById("png-btn").addEventListener("click", () => downloadFile(metadata.image, "PNG"));
            document.getElementById("vrm-btn").addEventListener("click", () => downloadFile(metadata.vrm_url, "VRM"));
            document.getElementById("fbx-btn").addEventListener("click", () => downloadFile(metadata.fbx_url, "FBX"));
            document.getElementById("usdz-btn").addEventListener("click", () => downloadFile(metadata.usdz_url, "USDZ"));
            document.getElementById("glb-btn").addEventListener("click", () => downloadFile(metadata.animation_url, "GLB"));
        }

        function downloadFile(url, type) {
            if (url) {
                const link = document.createElement('a');
                link.href = url;
                link.download = url.split('/').pop();
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                const params = new URLSearchParams(window.location.search);
                const id = params.get('id');
                gtag('event', 'download', {
                    'event_category': 'button_click',
                    'event_label': 'Download ' + type + ' Button - ID: ' + id
                });
            }
        }

        window.onload = fetchModelDetails;
    </script>
<div class="metadata"></div></body>
</html>
