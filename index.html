
<html>
  <head><style>
        model-viewer { 
            margin: 40px 0; 
            display: block; 
        }
        model-viewer:first-of-type { 
            margin-top: 0; 
        }
        model-viewer:last-of-type { 
            margin-bottom: 0; 
        }
    </style>
    <title>Web AR</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="demo-styles.css">
    <script src="https://github.com/lightlessdays/web-ar/blob/main/focus.js" defer></script>
    <script type="module">
        async function fetchModels() {
            try {
                const response = await fetch("https://cybermfers.sfo3.digitaloceanspaces.com/?prefix=cybermfers/public/assets/");
                const xmlText = await response.text();
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlText, "text/xml");
                const keys = xmlDoc.getElementsByTagName("Key");
                const modelPairs = {};

                // Grouping models into pairs (usdz and glb)
                for (let i = 0; i < keys.length; i++) {
                    const key = keys[i].textContent;
                    const basename = key.split('.')[0];
                    const ext = key.split('.')[1];

                    if (!modelPairs[basename]) {
                        modelPairs[basename] = {};
                    }

                    if (ext === 'usdz') {
                        modelPairs[basename]['usdz'] = key;
                    } else if (ext === 'glb') {
                        modelPairs[basename]['glb'] = key;
                    }
                }

                // Create model-viewer elements for each pair
                const container = document.getElementById("models-container");
                for (const basename in modelPairs) {
                    const usdz = modelPairs[basename]['usdz'];
                    const glb = modelPairs[basename]['glb'];

                    if (usdz && glb) {
                        const modelViewer = document.createElement("model-viewer");
                        modelViewer.setAttribute("src", `https://cybermfers.sfo3.digitaloceanspaces.com/${glb}`);
                        modelViewer.setAttribute("ios-src", `https://cybermfers.sfo3.digitaloceanspaces.com/${usdz}`);
                        modelViewer.setAttribute("shadow-intensity", "1");
                        modelViewer.setAttribute("camera-controls", "");
                        modelViewer.setAttribute("auto-rotate", "");
                        modelViewer.setAttribute("ar", "");
                        container.appendChild(modelViewer);
                    }
                }
            } catch (error) {
                console.error("Failed to fetch and display models:", error);
            }
        }

        window.onload = fetchModels;
    </script>
  </head>
  <body>
    <div id="card">
      <div id="models-container"></div>
      <section class="attribution">
        <span>
          <h1>Web AR Viewer</h1>
          <span>To view the source code, <a href="https://github.com/lightlessdays/web-ar" target="_blank">click here.</a></span>
        </span>
        <a class="cc" href="https://github.com/lightlessdays/web-ar/blob/main/LICENSE.md" target="_blank">
          <img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg">
          <img src="https://mirrors.creativecommons.org/presskit/icons/by.svg">
        </a>
      </section>
    </div>
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  </body>
</html>
